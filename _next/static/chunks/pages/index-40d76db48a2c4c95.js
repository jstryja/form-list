(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(4698)}])},4698:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return _}});var s=t(5893),n=t(9163),r=t(442),i=t(1230),o=t(5746),a=t(6713),d=t(4749),c=t(137),m=t(4494),x=t(3232),p=t(3671),u=t.n(p),h=t(7294);let f=e=>{let l=[],t=new Map;for(let s of e){let e=s.profession,n={title:s.title,street:s.street,city:s.city,person:s.person,phone:s.phone,email:s.email,web:s.web};if(t.has(e)){let l=t.get(e);l.firms.push(n)}else{let s={profession:e,firms:[n]};l.push(s),t.set(e,s)}}return l};var j=t(5733),b=t.n(j),g=t(3162),Z=t(3024),v=t.n(Z),y=t(3704),k=t(465);let{Dragger:w}=y.Z,F=e=>{let{update:l}=e,[t,n]=(0,h.useState)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w,{customRequest:e=>{let{onSuccess:l}=e;l&&l("ok")},beforeUpload:e=>{let l="text/csv"===e.type;return l||k.ZP.error("".concat(e.name," nen\xed csv soubor.")),l||y.Z.LIST_IGNORE},maxCount:1,onChange:e=>{if("done"===e.file.status){let l=new FileReader;l.onload=e=>{var l;e.preventDefault(),"string"==typeof(null===(l=e.target)||void 0===l?void 0:l.result)&&n(e.target.result)},e.file.originFileObj&&l.readAsText(e.file.originFileObj)}},children:(0,s.jsx)("p",{className:"ant-upload-text",children:"Nahrej CSV"})}),(0,s.jsx)(d.ZP,{type:"primary",onClick:()=>{t?(localStorage.setItem("firm-list",t),console.log("file",t),k.ZP.success("Soubor nahr\xe1n.")):k.ZP.error("Pr\xe1zdn\xfd soubor"),l()},disabled:!t,children:"ULOŽIT CSV"})]})};var S=t(1876).Buffer;let{Dragger:I}=y.Z,P=e=>{let{setFieldValue:l,btnDisabled:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Z.Item,{name:"template",children:(0,s.jsx)(I,{customRequest:e=>{let{onSuccess:l}=e;l&&l("ok")},beforeUpload:e=>{let l="application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e.type;return l||k.ZP.error("".concat(e.name," nen\xed docx soubor.")),l||y.Z.LIST_IGNORE},maxCount:1,onChange:e=>{if("done"===e.file.status){let t=new FileReader;t.onload=async e=>{var t;e.preventDefault();let s=S.from(null===(t=e.target)||void 0===t?void 0:t.result);l("template",s)},e.file.originFileObj&&t.readAsArrayBuffer(e.file.originFileObj)}},children:(0,s.jsx)("p",{className:"ant-upload-text",children:"Nahrej šablonu .docx"})})}),(0,s.jsx)(d.ZP,{disabled:t,htmlType:"submit",children:"St\xe1hnout zip"})]})},N=e=>{let{}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Z.Item,{label:"Datum, kdy pos\xedl\xe1m dopis",name:"sendDate",children:(0,s.jsx)(m.Z,{})}),(0,s.jsx)(r.Z.Item,{label:"N\xe1zev akce",name:"title",children:(0,s.jsx)(m.Z,{})}),(0,s.jsx)(r.Z.Item,{label:"Předpokl\xe1dan\xfd term\xedn realizace",name:"estimateDate",children:(0,s.jsx)(m.Z,{})}),(0,s.jsx)(r.Z.Item,{label:"M\xedsto plněn\xed",name:"place",children:(0,s.jsx)(m.Z,{})}),(0,s.jsx)(r.Z.Item,{label:"Datum do kdy maj\xed poslat cenovou nab\xeddku",name:"deadlineDate",children:(0,s.jsx)(m.Z,{})})]})},C=e=>{let{update:l,setFieldValue:t,btnDisabled:n}=e;return(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(o.Z,{span:6,children:(0,s.jsxs)(a.Z,{children:[(0,s.jsx)(F,{update:l}),(0,s.jsx)(P,{setFieldValue:t,btnDisabled:n})]})}),(0,s.jsx)(o.Z,{span:18,children:(0,s.jsx)(N,{})}),(0,s.jsx)(c.Z,{})]})},{Panel:O}=n.Z;function _(){let[e,l]=(0,h.useState)(),[t,p]=(0,h.useState)([]),[j,Z]=(0,h.useState)(!1),[y,k]=(0,h.useState)(),w=()=>{console.log("update");let e=localStorage.getItem("firm-list");e&&u()().fromString(e).then(e=>{l(f(e)[0]),p(f(e))})};(0,h.useEffect)(()=>{{let e=localStorage.getItem("firm-list-form");k(e?JSON.parse(e):null),w()}},[]);let[F]=r.Z.useForm();(0,h.useEffect)(()=>{F.resetFields()},[y]);let S=new(b()),I=async e=>{let l=[];Object.keys(e.checked).filter(t=>{Object.values(e.checked[t]).some(e=>!0===e)&&l.push(t)});let s=t.filter(e=>l.includes(e.profession));Z(!0);let n=s.map(async l=>{var t;let{sendDate:s,title:n,estimateDate:r,place:i,deadlineDate:o,workType:a,template:d}=e,c=S.folder(l.profession),m=[];Object.keys(null==e?void 0:null===(t=e.checked)||void 0===t?void 0:t[l.profession]).map(t=>{var s,n;(null==e?void 0:null===(s=e.checked)||void 0===s?void 0:null===(n=s[l.profession])||void 0===n?void 0:n[t])&&m.push(t)});let x=l.firms.filter(e=>m.includes(e.title)),p=x.map(async e=>new Promise(async t=>{let m=await v()({template:d,data:{sendDate:s,title:n,estimateDate:r,place:i,deadlineDate:o,workType:a[l.profession],firmTitle:e.title||"",firmStreet:e.street||"",firmCity:e.city||"",firmPerson:e.person||"",firmPhone:e.phone||"",firmEmail:e.email||""}});null==c||c.file("".concat(e.title,".docx"),m),t()}));return await Promise.all(p),p});await Promise.all(n),console.log("3",n.length),console.log("done"),S.generateAsync({type:"blob"}).then(function(e){console.log("content",e),(0,g.saveAs)(e,"dopisy.zip")}),Z(!1)},P=e=>{let l=localStorage.getItem("firm-list-form"),t=l?JSON.parse(l):null,s={...t,...e};delete s.template,localStorage.setItem("firm-list-form",JSON.stringify(s))};return(0,s.jsx)("div",{style:{height:"100vh",background:"white",padding:"1rem"},children:(0,s.jsxs)(r.Z,{form:F,onFinish:I,labelCol:{span:10},wrapperCol:{span:14},onValuesChange:P,initialValues:y,children:[(0,s.jsx)(C,{btnDisabled:j,update:w,setFieldValue:F.setFieldValue}),(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(o.Z,{lg:7,md:8,sm:10,xs:11,children:(0,s.jsx)(a.Z,{direction:"vertical",style:{width:"100%"},children:t.map((t,n)=>(0,s.jsx)(i.Z,{align:"middle",children:(0,s.jsx)(o.Z,{span:22,children:(0,s.jsxs)(d.ZP,{block:!0,type:t.profession===(null==e?void 0:e.profession)?"primary":"default",style:{display:"block",textAlign:"left",width:"100%"},onClick:()=>{l(t)},children:[n+1,". ",t.profession]})})},t.profession))})}),(0,s.jsx)(o.Z,{xs:1,children:(0,s.jsx)(c.Z,{type:"vertical",style:{height:"100%"}})}),(0,s.jsx)(o.Z,{lg:16,md:15,sm:13,xs:12,children:t.map(l=>{var t;return(0,s.jsxs)("div",{style:{display:l.profession===(null==e?void 0:e.profession)?"block":"none"},children:[(0,s.jsx)(r.Z.Item,{name:["workType",(null==l?void 0:l.profession)||""],label:"Dobr\xfd den, jako uchazeč o gener\xe1ln\xedho dodavatele t\xe9to stavby se na V\xe1s obrac\xedm se ž\xe1dost\xed o zpracov\xe1n\xed cenov\xe9 nab\xeddky na",labelCol:{span:24},children:(0,s.jsx)(m.Z,{style:{marginBottom:"0.5rem",marginTop:0},placeholder:"typ pr\xe1ce"})}),null==l?void 0:null===(t=l.firms)||void 0===t?void 0:t.map(e=>(0,s.jsxs)(i.Z,{align:"middle",children:[(0,s.jsx)(o.Z,{sm:2,md:1,children:(0,s.jsx)(r.Z.Item,{name:["checked",l.profession,e.title],valuePropName:"checked",style:{marginBlock:0},children:(0,s.jsx)(x.Z,{})})}),(0,s.jsx)(o.Z,{sm:18,md:19,children:(0,s.jsx)(n.Z,{children:(0,s.jsxs)(O,{header:e.title,children:[e.title&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("b",{children:e.title})," ",(0,s.jsx)("br",{})]}),e.street&&(0,s.jsxs)(s.Fragment,{children:[e.street,(0,s.jsx)("br",{})]}),e.city&&(0,s.jsxs)(s.Fragment,{children:[e.city,(0,s.jsx)("br",{})]}),(0,s.jsx)("br",{}),e.person&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("b",{children:e.person})," ",(0,s.jsx)("br",{})]}),e.phone&&(0,s.jsxs)(s.Fragment,{children:[e.phone,(0,s.jsx)("br",{})]}),e.email&&(0,s.jsxs)(s.Fragment,{children:[e.email,(0,s.jsx)("br",{})]})]},e.title)})}),(0,s.jsx)(o.Z,{sm:4,md:4,style:{paddingLeft:"1rem"},children:e.web&&(0,s.jsx)("a",{style:{color:"black"},href:e.web,target:"blank",children:"WEB"})})]},e.title))]},l.profession)})})]})]})})}}},function(e){e.O(0,[808,150,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);