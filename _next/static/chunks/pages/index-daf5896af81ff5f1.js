(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(8146)}])},8146:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return C}});var r=l(5893),s=l(9163),n=l(442),i=l(1230),a=l(5746),o=l(6713),d=l(137),c=l(4749),m=l(4494),p=l(3671),u=l.n(p),x=l(7294);let f=e=>{let t=[],l=new Map;for(let r of e){let e=r.profession,s={title:r.title,street:r.street,city:r.city,person:r.person,phone:r.phone,email:r.email};if(l.has(e)){let t=l.get(e);t.firms.push(s)}else{let r={profession:e,firms:[s]};t.push(r),l.set(e,r)}}return t};var h=l(5733),j=l.n(h);let g=e=>{let{}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Z.Item,{label:"Datum, kdy pos\xedl\xe1m dopis",name:"sendDate",children:(0,r.jsx)(m.Z,{})}),(0,r.jsx)(n.Z.Item,{label:"N\xe1zev akce",name:"title",children:(0,r.jsx)(m.Z,{})}),(0,r.jsx)(n.Z.Item,{label:"Předpokl\xe1dan\xfd term\xedn realizace",name:"estimateDate",children:(0,r.jsx)(m.Z,{})}),(0,r.jsx)(n.Z.Item,{label:"M\xedsto plněn\xed",name:"place",children:(0,r.jsx)(m.Z,{})}),(0,r.jsx)(n.Z.Item,{label:"Datum do kdy maj\xed poslat cenovou nab\xeddku",name:"deadlineDate",children:(0,r.jsx)(m.Z,{})})]})};var b=l(3704),Z=l(465);let{Dragger:y}=b.Z,v=e=>{let{update:t}=e,[l,s]=(0,x.useState)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y,{customRequest:e=>{let{onSuccess:t}=e;t&&t("ok")},beforeUpload:e=>{let t="text/csv"===e.type;return t||Z.ZP.error("".concat(e.name," nen\xed csv soubor.")),t||b.Z.LIST_IGNORE},maxCount:1,onChange:e=>{if("done"===e.file.status){let t=new FileReader;t.onload=e=>{var t;e.preventDefault(),"string"==typeof(null===(t=e.target)||void 0===t?void 0:t.result)&&s(e.target.result)},e.file.originFileObj&&t.readAsText(e.file.originFileObj)}},children:(0,r.jsx)("p",{className:"ant-upload-text",children:"Nahrej CSV"})}),(0,r.jsx)(c.ZP,{type:"primary",onClick:()=>{l?(localStorage.setItem("firm-list",l),console.log("file",l),Z.ZP.success("Soubor nahr\xe1n.")):Z.ZP.error("Pr\xe1zdn\xfd soubor"),t()},disabled:!l,children:"ULOŽIT CSV"})]})};var S=l(1876).Buffer;let{Dragger:F}=b.Z,k=e=>{let{setFieldValue:t,isSubmitting:l}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Z.Item,{name:"template",children:(0,r.jsx)(F,{customRequest:e=>{let{onSuccess:t}=e;t&&t("ok")},beforeUpload:e=>{let t="application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e.type;return t||Z.ZP.error("".concat(e.name," nen\xed docx soubor.")),t||b.Z.LIST_IGNORE},maxCount:1,onChange:e=>{if("done"===e.file.status){let l=new FileReader;l.onload=async e=>{var l;e.preventDefault();let r=S.from(null===(l=e.target)||void 0===l?void 0:l.result);t("template",r)},e.file.originFileObj&&l.readAsArrayBuffer(e.file.originFileObj)}},children:(0,r.jsx)("p",{className:"ant-upload-text",children:"Nahrej šablonu .docx"})})}),(0,r.jsx)(c.ZP,{disabled:l,htmlType:"submit",children:"St\xe1hnout zip"})]})};var w=l(3162),I=l(3024),P=l.n(I);let{Panel:N}=s.Z;function C(){let[e,t]=(0,x.useState)(),[l,p]=(0,x.useState)([]),[h,b]=(0,x.useState)(!1),[Z,y]=(0,x.useState)(),S=()=>{let e=localStorage.getItem("firm-list");e&&u()().fromString(e).then(e=>{t(f(e)[0]),p(f(e))})};(0,x.useEffect)(()=>{{let e=localStorage.getItem("firm-list-form");y(e?JSON.parse(e):null),S()}},[]);let[F]=n.Z.useForm();(0,x.useEffect)(()=>{F.resetFields()},[Z]);let I=new(j()),C=async e=>{b(!0);let t=l.map(async t=>{let{sendDate:l,title:r,estimateDate:s,place:n,deadlineDate:i,workType:a,template:o}=e,d=I.folder(t.profession),c=t.firms.map(async e=>new Promise(async c=>{let m=await P()({template:o,data:{sendDate:l,title:r,estimateDate:s,place:n,deadlineDate:i,workType:a[t.profession],firmTitle:e.title||"",firmStreet:e.street||"",firmCity:e.city||"",firmPerson:e.person||"",firmPhone:e.phone||"",firmEmail:e.email||""}});null==d||d.file("".concat(e.title,".docx"),m),c()}));return await Promise.all(c),c});await Promise.all(t),console.log("done"),I.generateAsync({type:"blob"}).then(function(e){(0,w.saveAs)(e,"dopisy.zip")}),b(!1)},_=e=>{let t=localStorage.getItem("firm-list-form"),l=t?JSON.parse(t):null,r={...l,...e};localStorage.setItem("firm-list-form",JSON.stringify(r))};return(0,r.jsx)("div",{style:{height:"100vh",background:"white",padding:"1rem"},children:(0,r.jsxs)(n.Z,{form:F,onFinish:C,labelCol:{span:10},wrapperCol:{span:14},onValuesChange:_,initialValues:Z,children:[(0,r.jsxs)(i.Z,{children:[(0,r.jsx)(a.Z,{span:6,children:(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(v,{update:S}),(0,r.jsx)(k,{setFieldValue:F.setFieldValue,isSubmitting:h})]})}),(0,r.jsx)(a.Z,{span:18,children:(0,r.jsx)(g,{})}),(0,r.jsx)(d.Z,{})]}),(0,r.jsxs)(i.Z,{children:[(0,r.jsx)(a.Z,{span:4,children:(0,r.jsx)(o.Z,{direction:"vertical",children:l.map((l,s)=>(0,r.jsxs)(c.ZP,{block:!0,type:l.profession===(null==e?void 0:e.profession)?"primary":"default",style:{display:"block",textAlign:"left"},onClick:()=>{t(l)},children:[s+1,". ",l.profession]},l.profession))})}),(0,r.jsx)(a.Z,{span:1,children:(0,r.jsx)(d.Z,{type:"vertical",style:{height:"100%"}})}),(0,r.jsx)(a.Z,{span:18,children:l.map(t=>{var l;return(0,r.jsxs)("div",{style:{display:t.profession===(null==e?void 0:e.profession)?"block":"none"},children:[(0,r.jsx)(n.Z.Item,{name:["workType",(null==t?void 0:t.profession)||""],children:(0,r.jsx)(m.Z,{style:{marginBottom:"0.5rem"},placeholder:"typ pr\xe1ce"})}),(0,r.jsx)(s.Z,{children:null==e?void 0:null===(l=e.firms)||void 0===l?void 0:l.map((e,t)=>(0,r.jsxs)(N,{header:e.title,children:[e.title&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("b",{children:e.title})," ",(0,r.jsx)("br",{})]}),e.street&&(0,r.jsxs)(r.Fragment,{children:[e.street,(0,r.jsx)("br",{})]}),e.city&&(0,r.jsxs)(r.Fragment,{children:[e.city,(0,r.jsx)("br",{})]}),(0,r.jsx)("br",{}),e.person&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("b",{children:e.person})," ",(0,r.jsx)("br",{})]}),e.phone&&(0,r.jsxs)(r.Fragment,{children:[e.phone,(0,r.jsx)("br",{})]}),e.email&&(0,r.jsxs)(r.Fragment,{children:[e.email,(0,r.jsx)("br",{})]})]},e.title||t))})]},t.profession)})})]})]})})}}},function(e){e.O(0,[808,198,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);