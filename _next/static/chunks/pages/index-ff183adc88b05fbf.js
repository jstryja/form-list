(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(8146)}])},8146:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return N}});var s=l(5893),n=l(9163),r=l(442),i=l(1230),a=l(5746),o=l(6713),d=l(137),c=l(4749),x=l(4494),m=l(3671),p=l.n(m),u=l(7294);let f=e=>{let t=[],l=new Map;for(let s of e){let e=s.profession,n={title:s.title,street:s.street,city:s.city,person:s.person,phone:s.phone,email:s.email};if(l.has(e)){let t=l.get(e);t.firms.push(n)}else{let s={profession:e,firms:[n]};t.push(s),l.set(e,s)}}return t};var h=l(5733),j=l.n(h);let b=e=>{let{}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Z.Item,{label:"Datum, kdy pos\xedl\xe1m dopis",name:"sendDate",children:(0,s.jsx)(x.Z,{})}),(0,s.jsx)(r.Z.Item,{label:"N\xe1zev akce",name:"title",children:(0,s.jsx)(x.Z,{})}),(0,s.jsx)(r.Z.Item,{label:"Předpokl\xe1dan\xfd term\xedn realizace",name:"estimateDate",children:(0,s.jsx)(x.Z,{})}),(0,s.jsx)(r.Z.Item,{label:"M\xedsto plněn\xed",name:"place",children:(0,s.jsx)(x.Z,{})}),(0,s.jsx)(r.Z.Item,{label:"Datum do kdy maj\xed poslat cenovou nab\xeddku",name:"deadlineDate",children:(0,s.jsx)(x.Z,{})})]})};var g=l(3704),y=l(465);let{Dragger:Z}=g.Z,v=e=>{let{update:t}=e,[l,n]=(0,u.useState)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z,{customRequest:e=>{let{onSuccess:t}=e;t&&t("ok")},beforeUpload:e=>{let t="text/csv"===e.type;return t||y.ZP.error("".concat(e.name," nen\xed csv soubor.")),t||g.Z.LIST_IGNORE},maxCount:1,onChange:e=>{if("done"===e.file.status){let t=new FileReader;t.onload=e=>{var t;e.preventDefault(),"string"==typeof(null===(t=e.target)||void 0===t?void 0:t.result)&&n(e.target.result)},e.file.originFileObj&&t.readAsText(e.file.originFileObj)}},children:(0,s.jsx)("p",{className:"ant-upload-text",children:"Nahrej CSV"})}),(0,s.jsx)(c.ZP,{type:"primary",onClick:()=>{l?(localStorage.setItem("firm-list",l),console.log("file",l),y.ZP.success("Soubor nahr\xe1n.")):y.ZP.error("Pr\xe1zdn\xfd soubor"),t()},disabled:!l,children:"ULOŽIT CSV"})]})};var S=l(1876).Buffer;let{Dragger:k}=g.Z,F=e=>{let{setFieldValue:t,isSubmitting:l}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Z.Item,{name:"template",children:(0,s.jsx)(k,{customRequest:e=>{let{onSuccess:t}=e;t&&t("ok")},beforeUpload:e=>{let t="application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e.type;return t||y.ZP.error("".concat(e.name," nen\xed docx soubor.")),t||g.Z.LIST_IGNORE},maxCount:1,onChange:e=>{if("done"===e.file.status){let l=new FileReader;l.onload=async e=>{var l;e.preventDefault();let s=S.from(null===(l=e.target)||void 0===l?void 0:l.result);t("template",s)},e.file.originFileObj&&l.readAsArrayBuffer(e.file.originFileObj)}},children:(0,s.jsx)("p",{className:"ant-upload-text",children:"Nahrej šablonu .docx"})})}),(0,s.jsx)(c.ZP,{disabled:l,htmlType:"submit",children:"St\xe1hnout zip"})]})};var w=l(3162),I=l(3024),P=l.n(I);let{Panel:C}=n.Z;function N(){let[e,t]=(0,u.useState)(),[l,m]=(0,u.useState)([]),[h,g]=(0,u.useState)(!1),[y,Z]=(0,u.useState)(),S=()=>{let e=localStorage.getItem("firm-list");e&&p()().fromString(e).then(e=>{t(f(e)[0]),m(f(e))})};(0,u.useEffect)(()=>{{let e=localStorage.getItem("firm-list-form");Z(e?JSON.parse(e):null),S()}},[]);let[k]=r.Z.useForm();(0,u.useEffect)(()=>{k.resetFields()},[y]);let I=new(j()),N=async e=>{g(!0);let t=l.map(async t=>{let{sendDate:l,title:s,estimateDate:n,place:r,deadlineDate:i,workType:a,template:o}=e,d=I.folder(t.profession),c=t.firms.map(async e=>new Promise(async c=>{let x=await P()({template:o,data:{sendDate:l,title:s,estimateDate:n,place:r,deadlineDate:i,workType:a[t.profession],firmTitle:e.title||"",firmStreet:e.street||"",firmCity:e.city||"",firmPerson:e.person||"",firmPhone:e.phone||"",firmEmail:e.email||""}});null==d||d.file("".concat(e.title,".docx"),x),c()}));return await Promise.all(c),c});await Promise.all(t),console.log("done"),I.generateAsync({type:"blob"}).then(function(e){(0,w.saveAs)(e,"dopisy.zip")}),g(!1)},_=e=>{let t=localStorage.getItem("firm-list-form"),l=t?JSON.parse(t):null,s={...l,...e};localStorage.setItem("firm-list-form",JSON.stringify(s))};return(0,s.jsx)("div",{style:{height:"100vh",background:"white",padding:"1rem"},children:(0,s.jsxs)(r.Z,{form:k,onFinish:N,labelCol:{span:10},wrapperCol:{span:14},onValuesChange:_,initialValues:y,children:[(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(a.Z,{span:6,children:(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(v,{update:S}),(0,s.jsx)(F,{setFieldValue:k.setFieldValue,isSubmitting:h})]})}),(0,s.jsx)(a.Z,{span:18,children:(0,s.jsx)(b,{})}),(0,s.jsx)(d.Z,{})]}),(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(a.Z,{span:4,children:(0,s.jsx)(o.Z,{direction:"vertical",children:l.map((l,n)=>(0,s.jsxs)(c.ZP,{block:!0,type:l.profession===(null==e?void 0:e.profession)?"primary":"default",style:{display:"block",textAlign:"left"},onClick:()=>{t(l)},children:[n+1,". ",l.profession]},l.profession))})}),(0,s.jsx)(a.Z,{span:1,children:(0,s.jsx)(d.Z,{type:"vertical",style:{height:"100%"}})}),(0,s.jsx)(a.Z,{span:18,children:l.map(t=>{var l;return(0,s.jsxs)("div",{style:{display:t.profession===(null==e?void 0:e.profession)?"block":"none"},children:[(0,s.jsx)(r.Z.Item,{name:["workType",(null==t?void 0:t.profession)||""],label:"Dobr\xfd den, jako uchazeč o gener\xe1ln\xedho dodavatele t\xe9to stavby se na V\xe1s obrac\xedm se ž\xe1dost\xed o zpracov\xe1n\xed cenov\xe9 nab\xeddky na",labelCol:{span:24},children:(0,s.jsx)(x.Z,{style:{marginBottom:"0.5rem"},placeholder:"typ pr\xe1ce"})}),(0,s.jsx)(n.Z,{children:null==e?void 0:null===(l=e.firms)||void 0===l?void 0:l.map((e,t)=>(0,s.jsxs)(C,{header:e.title,children:[e.title&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("b",{children:e.title})," ",(0,s.jsx)("br",{})]}),e.street&&(0,s.jsxs)(s.Fragment,{children:[e.street,(0,s.jsx)("br",{})]}),e.city&&(0,s.jsxs)(s.Fragment,{children:[e.city,(0,s.jsx)("br",{})]}),(0,s.jsx)("br",{}),e.person&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("b",{children:e.person})," ",(0,s.jsx)("br",{})]}),e.phone&&(0,s.jsxs)(s.Fragment,{children:[e.phone,(0,s.jsx)("br",{})]}),e.email&&(0,s.jsxs)(s.Fragment,{children:[e.email,(0,s.jsx)("br",{})]})]},e.title||t))})]},t.profession)})})]})]})})}}},function(e){e.O(0,[808,198,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);